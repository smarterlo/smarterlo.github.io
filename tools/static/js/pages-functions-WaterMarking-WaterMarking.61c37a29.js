(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-functions-WaterMarking-WaterMarking"],{"319e":function(t,e,a){var n=a("4182");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=a("4f06").default;i("7da702f8",n,!0,{sourceMap:!1,shadowMode:!1})},"3b0c":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"content"},t._l(t.canvasArr,(function(e){return a("v-uni-view",[a("v-uni-canvas",{style:{width:t.canvasWidth+"px",height:t.canvasHeight+"px"},attrs:{"canvas-id":"myCanvas"}})],1)})),1)},i=[]},4182:function(t,e,a){var n=a("24fb");e=n(!1),e.push([t.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.content[data-v-245bc4d8]{width:0;height:0;overflow:hidden}',""]),t.exports=e},4503:function(t,e,a){"use strict";var n=a("ab64"),i=a.n(n);i.a},4522:function(t,e,a){"use strict";var n=a("319e"),i=a.n(n);i.a},"540b":function(t,e,a){var n=a("24fb");e=n(!1),e.push([t.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */uni-page-body[data-v-058543f3]{background:linear-gradient(180deg,#f9f9f9 0,#f7f6f6)}body.?%PAGE?%[data-v-058543f3]{background:linear-gradient(180deg,#f9f9f9 0,#f7f6f6)}.login-btn[data-v-058543f3]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.btn-class[data-v-058543f3]{margin-top:20px;width:90vw;font-size:14px;color:#505050;padding:5px;background-color:#fff}.page-lable[data-v-058543f3]{width:90vw;padding:10px 0;color:#3c3c3c}.img-box[data-v-058543f3]{width:90vw;min-height:60vh;border-radius:5px;text-align:center;border:1px solid #dcdcdc;background-color:#fff;padding:10px 0}.img-box img[data-v-058543f3]{max-width:100%;margin:10px 0}',""]),t.exports=e},"5a7d":function(t,e,a){"use strict";a.r(e);var n=a("3b0c"),i=a("7b7e");for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);a("4522");var s=a("f0c5"),r=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"245bc4d8",null,!1,n["a"],void 0);e["default"]=r.exports},6106:function(t,e,a){"use strict";a.r(e);var n=a("d38c"),i=a("e793");for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);a("4503");var s=a("f0c5"),r=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"058543f3",null,!1,n["a"],void 0);e["default"]=r.exports},"70c6":function(t,e,a){"use strict";a("7a82");var n=a("ee27").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("14d9");var i,o=n(a("5a7d")),s={components:{tnWaterMater:o.default},data:function(){return{photoData:"",text:"皮皮工具箱",path:""}},onLoad:function(){switch(i=this,i.$store.state.platform){case"android":console.log("运行Android上");break;case"ios":Vue.prototype.requestIosPermission("photoLibrary","相册"),console.log("运行iOS上");break;default:console.log("运行在开发者工具上");break}},methods:{save:function(){uni.saveImageToPhotosAlbum({filePath:this.path,success:function(){uni.showToast({title:"保存完毕",duration:2e3})}})},backImage:function(t){console.log(t),this.path=t.path,this.photoData.push(t.base)},addWaterBase64:function(){var t={};t.url=this.photoData[0],t.watermark=[{type:"text",fillStyle:"rgba(250, 250, 250, 1)",content:this.text,font:"6px",x:0,y:0,shadowColor:"rgba(0, 0, 0, 1)",shadowOffsetX:2,shadowOffsetY:2,rotate:0,repeatWidth:1500,repeatHeight:2e3,isRepeat:!0}],this.$refs.childWaterMater.addWaterMark(t)},selectImg:function(){this.photoData="";var t=this;uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(e){t.photoData=e.tempFilePaths},fail:function(t){}})}}};e.default=s},"729a":function(t,e,a){"use strict";a("7a82"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("a434"),a("d3b7"),a("14d9");var n={props:{},data:function(){return{canvasArr:[],platformType:"other",canvasWidth:"",canvasHeight:"",pixelRatio:1}},mounted:function(){var t=this;t.platformType="h5",wx.getSystemInfo({success:function(e){console.log(e),t.pixelRatio=e.pixelRatio}})},methods:{addWaterMark:function(t){"h5"==this.platformType?this.h5CanvasDraw(t):this.otherCanvasReady(t)},otherCanvasReady:function(t){var e=this;uni.getImageInfo({src:t.url,success:function(a){var n=t.maxSize||0;t.maxSize?a.width>a.height?(a.width<n?n=a.width/e.pixelRatio:n/=e.pixelRatio,e.canvasWidth=n,e.canvasHeight=a.height/(a.width/n)):(a.height<n?n=a.height/e.pixelRatio:n/=e.pixelRatio,e.canvasHeight=n,e.canvasWidth=a.width/(a.height/n)):(e.canvasWidth=a.width/e.pixelRatio,e.canvasHeight=a.height/e.pixelRatio),e.canvasArr.splice(0,1,1),e.$nextTick((function(){e.otherCanvasDraw(t,a)}))}})},otherCanvasDraw:function(t,e){var a=this,n=uni.createCanvasContext("myCanvas",a);n.drawImage(e.path,0,0,a.canvasWidth,a.canvasHeight),n.textAlign=t.textAlign||"top",n.textBaseline=t.textBaseline||"top";var i=[],o=[];t.watermark.some((function(t,e){"image"==t.type&&i.push(t),"text"==t.type&&o.push(t)})),o.length>0?(console.log("文字无水印"),o.some((function(t,e){n.font=(t.font||"16px")+" Arial",n.shadowColor=t.shadowColor||"#000",n.shadowOffsetX=t.shadowOffsetX||0,n.shadowOffsetY=t.shadowOffsetY||0,n.fillStyle=t.fillStyle||"#fff";n.measureText(t.content).width;var i=t.rotate||0;if(t.x=t.x||0,t.y=t.y||0,t.isRepeat){t.repeatWidth=t.repeatWidth||a.canvasWidth,t.repeatHeight=t.repeatHeight||a.canvasHeight,t.distanceX=t.distanceX||60,t.distanceY=t.distanceY||50,n.rotate(-i*Math.PI/180);for(var o=t.x;o<t.repeatWidth;o+=t.distanceX)for(var s=t.y;s<t.repeatHeight;s+=t.distanceY)n.fillText(t.content,o,s);n.rotate(i*Math.PI/180)}else n.rotate(-i*Math.PI/180),n.fillText(t.content,t.x,t.y),n.rotate(i*Math.PI/180)})),a.otherGenerateBase64(t,n)):i.some((function(e,o){uni.getImageInfo({src:e.path,success:function(s){var r=e.rotate||0;if(e.x=e.x||0,e.y=e.y||0,e.width=e.width||s.width/a.pixelRatio,e.height=e.height||s.height/a.pixelRatio,e.isRepeat){e.repeatWidth=e.repeatWidth||a.canvasWidth,e.repeatHeight=e.repeatHeight||a.canvasHeight,e.distanceX=e.distanceX||60,e.distanceY=e.distanceY||50,n.rotate(-r*Math.PI/180);for(var c=e.x;c<e.repeatWidth;c+=e.distanceX)for(var h=e.y;h<e.repeatHeight;h+=e.distanceY)console.log(e.x,e.y),n.drawImage(s.path,c,h,e.width,e.height);n.rotate(r*Math.PI/180)}else n.rotate(-r*Math.PI/180),n.drawImage(s.path,e.x,e.y,e.width,e.height),n.rotate(r*Math.PI/180);i.length==o+1&&a.otherGenerateBase64(t,n)}})}))},otherGenerateBase64:function(t,e){var a=this;e.draw(!0,(function(e){uni.canvasToTempFilePath({canvasId:"myCanvas",quality:t.quality||1,complete:function(t){var e=t.tempFilePath,n=plus.io.convertLocalFileSystemURL(e),i=new plus.io.FileReader;i.readAsDataURL(n),i.onloadend=function(t){var n={base:t.target.result,path:e};a.$emit("pBackImage",n)}}})}))},h5CanvasDraw:function(t){var e=this,a=new Image;a.src=t.url,a.crossOrigin="anonymous",a.onload=function(){var n=document.createElement("canvas"),i=t.maxSize||0;t.maxSize?a.width>a.height?(a.width<i&&(i=a.width),e.canvasWidth=i,e.canvasHeight=a.height/(a.width/i)):(a.height<i&&(i=a.height),e.canvasHeight=i,e.canvasWidth=a.width/(a.height/i)):(e.canvasWidth=a.width,e.canvasHeight=a.height),n.width=e.canvasWidth,n.height=e.canvasHeight;var o=n.getContext("2d");o.drawImage(a,0,0),o.textAlign=t.textAlign||"top",o.textBaseline=t.textBaseline||"top";var s=[],r=[];t.watermark.some((function(t,e){"image"==t.type&&s.push(t),"text"==t.type&&r.push(t)})),r.some((function(t,a){o.font=(t.font||"16px")+" Arial",o.shadowColor=t.shadowColor||"#000",o.shadowOffsetX=t.shadowOffsetX||0,o.shadowOffsetY=t.shadowOffsetY||0,o.fillStyle=t.fillStyle||"#fff";o.measureText(t.content).width;var n=t.rotate||0;if(t.x=t.x||0,t.y=t.y||0,t.isRepeat){t.repeatWidth=t.repeatWidth||e.canvasWidth,t.repeatHeight=t.repeatHeight||e.canvasHeight,t.distanceX=t.distanceX||60,t.distanceY=t.distanceY||50,o.rotate(-n*Math.PI/180);for(var i=t.x;i<t.repeatWidth;i+=t.distanceX)for(var s=t.y;s<t.repeatHeight;s+=t.distanceY)console.log(t.x,t.y),o.fillText(t.content,i,s);o.rotate(n*Math.PI/180)}else o.rotate(-n*Math.PI/180),o.fillText(t.content,t.x,t.y),o.rotate(n*Math.PI/180)})),s.some((function(t,a){var i=new Image;i.src=t.path,i.crossOrigin="anonymous",i.onload=function(){var r=t.rotate||0;if(t.x=t.x||0,t.y=t.y||0,t.width=t.width||i.width,t.height=t.height||i.height,t.isRepeat){t.repeatWidth=t.repeatWidth||e.canvasWidth,t.repeatHeight=t.repeatHeight||e.canvasHeight,t.distanceX=t.distanceX||60,t.distanceY=t.distanceY||50,o.rotate(-r*Math.PI/180);for(var c=t.x;c<t.repeatWidth;c+=t.distanceX)for(var h=t.y;h<t.repeatHeight;h+=t.distanceY)console.log(t.x,t.y),o.drawImage(i,c,h,t.width,t.height);o.rotate(r*Math.PI/180)}else o.rotate(-r*Math.PI/180),o.drawImage(i,t.x,t.y,t.width,t.height),o.rotate(r*Math.PI/180);if(s.length==a+1){var d=n.toDataURL();e.$emit("pBackImage",d)}}}))}}}};e.default=n},"7b7e":function(t,e,a){"use strict";a.r(e);var n=a("729a"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},ab64:function(t,e,a){var n=a("540b");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=a("4f06").default;i("4ff9aa61",n,!0,{sourceMap:!1,shadowMode:!1})},d38c:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("v-uni-view",{staticClass:"login-bg"},[a("v-uni-view",{staticClass:"login-btn"},[a("v-uni-input",{staticClass:"btn-class",staticStyle:{height:"100rpx"},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1)],1),a("tnWaterMater",{ref:"childWaterMater",on:{pBackImage:function(e){arguments[0]=e=t.$handleEvent(e),t.backImage.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"login-bg"},[a("v-uni-view",{staticClass:"login-btn"},[a("v-uni-button",{staticClass:"btn-class",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectImg.apply(void 0,arguments)}}},[t._v("选择图片")]),a("v-uni-button",{staticClass:"btn-class",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.addWaterBase64.apply(void 0,arguments)}}},[t._v("加水印")]),t.path?a("v-uni-button",{staticClass:"btn-class",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.save.apply(void 0,arguments)}}},[t._v("保存")]):t._e(),a("v-uni-text",{staticClass:"page-lable"},[t._v("结果:")]),a("v-uni-view",{staticClass:"img-box"},t._l(t.photoData,(function(t){return a("img",{attrs:{src:t}})})),0)],1)],1)],1)},i=[]},e793:function(t,e,a){"use strict";a.r(e);var n=a("70c6"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a}}]);